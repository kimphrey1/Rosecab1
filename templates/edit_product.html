{% extends 'admin_base.html' %}
{% block main %}

<div class="card shadow">
    <div class="card-body">
        <h5 class="p-2" style="border-bottom: 2px solid orange;">Edit Product</h5>
        <div class="container-fluid">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ product_form.as_p }}
                
                <h5 class="mt-4">Product Variants</h5>
                <table id="variant-table" class="table">
                    {{ variant_formset.management_form }}
                    {{ variant_formset.as_table }}
                </table>
                <button type="button" class="btn btn-success" id="add-variant">Add Variant</button>

                <input type="submit" value="Save changes" class="m-2 px-3 btn btn-primary">
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let formsetTable = document.getElementById("variant-table");
        let addButton = document.getElementById("add-variant");
    
        addButton.addEventListener("click", function () {
            // Clone the last row in the formset table
            let lastRow = formsetTable.rows[formsetTable.rows.length - 1];
            let newRow = lastRow.cloneNode(true);
    
            // Update the input names to include the correct formset index
            let currentIndex = formsetTable.rows.length - 1;
            let newFormsetIndex = currentIndex + 1;
    
            newRow.querySelectorAll("input, select").forEach(function (element) {
                let oldName = element.getAttribute("name");
                let newName = oldName.replace(/-\d+-/, "-" + newFormsetIndex + "-");
                element.setAttribute("name", newName);
                element.value = "";  // Clear input values for the new row
            });
    
            // Remove the delete checkbox from the new row
            newRow.querySelector(".delete-variant").remove();
    
            // Append the new row to the table
            formsetTable.appendChild(newRow);
        });
    });
</script>

{% endblock %}
